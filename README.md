# Stellaris Mapper - 星图生成工具

这是一个将星表数据转换为太空科幻大战略游戏使用的航道图的工具。

## 功能特性

1. 读取CSV/Excel文件以导入星表数据
2. 过滤掉对象类型为Planet的对象，仅保留恒星
3. 自动识别多星系统（拥有相同的星系ID），并合并为一点
4. 将天球赤道坐标系转换为游戏常用的三维直角坐标系
5. 将星表数据处理为点集后，进行Delaunay四面体剖分
6. 对四面体剖分生成的连接网络进行优化，删除过远的连接
7. 检测生成的网络是否整体连通
8. 将生成的网络图保存为JSON格式
9. 生成星图网络的可视化图片（在Windows平台上）或信息文件（在其他平台）

## 系统要求

- .NET 8.0 或更高版本
- 支持的操作系统: Windows, macOS, Linux

## 安装说明

1. 克隆或下载此仓库
2. 确保已安装.NET 8.0 SDK
3. 在项目根目录运行以下命令来还原依赖包:
   ```
   dotnet restore
   ```

## 使用方法

### 构建项目
```bash
cd src/StellarisMapper
dotnet build
```

### 运行程序
```bash
dotnet run -- <输入文件路径> <输出文件路径> [最大跳跃距离(秒差距, 默认10.0)]
```

### 示例
```bash
dotnet run -- data/The10pcSample_v3.xlsx output/stellar_network2.json 3.33 --include-lm --include-wd --include-bd

## 输出格式

生成的JSON文件包含以下结构:

```json
{
  "jump_distance": 10.0,
  "systems": [
    {
      "id": 0,
      "name": "System Name",
      "sp_type": "G",
      "x": 1.23,
      "y": 4.56,
      "z": 7.89,
      "stars": [
        {
          "name": "Star A",
          "sp_type": "G"
        },
        {
          "name": "Star B",
          "sp_type": "M"
        }
      ]
    }
  ],
  "connections": [
    {
      "system1_id": 0,
      "system2_id": 1,
      "distance": 5.67
    }
  ]
}
```

## 可视化功能

工具会自动生成星图网络的可视化表示，使用跨平台的ImageSharp库实现：

- 生成PNG格式的星图图片，适用于所有平台（Windows、Linux、macOS）
- 图片尺寸为2000x2000像素，显示恒星系统作为彩色圆点和系统间的连接线

可视化文件与JSON输出文件位于同一目录，文件名相同但扩展名不同。

### 可视化特性
生成的星图图片包含以下元素：
- 黑色背景
- 恒星系统作为彩色圆点，颜色根据恒星类型编码：
  - A型恒星：青色（RGB：0，255，255）
  - F型恒星：白色（RGB：255，255，255）
  - G型恒星：黄色（RGB：255，255，0）
  - K型恒星：橙色（RGB：255，127，0）
  - M型恒星：红色（RGB：255，0，0）
  - L型恒星（褐矮星）：紫色（RGB：255，0，255）
  - 白矮星（WD或WD?）：绿色（RGB：0，255，0）
  - 褐矮星（BD或BD?）：紫色（RGB：255，0，255）
- OBJ_CAT为*的大质量恒星绘制得比其他点更大
- 多星系统中的每个恒星都单独显示，围绕系统中心以圆形排列，每个恒星根据其光谱类型显示相应颜色
- 系统间的连接线（浅蓝色）
- 2D投影显示（基于X-Y平面）

## 网络连通性检测

## 网络连通性检测

工具会自动检测生成的星图网络是否整体连通。在网络统计信息中会显示连通性检查结果，这对于游戏平衡性非常重要，确保所有星系都可以通过跳跃到达。

连通性检测采用广度优先搜索(BFS)算法实现，从第一个星系开始遍历所有可达的星系，如果所有星系都被访问过，则网络是连通的。

## 可扩展性考虑

在开发太空科幻大战略游戏时，Hipparcos星表中的以下数据可能有用：

1. **视星等(V)** - 可用于确定恒星在游戏中的亮度和可见性
2. **颜色指数(B-V)** - 可用于确定恒星的颜色和温度
3. **自行运动(PMRA, PMDEC)** - 可用于模拟恒星在长时间尺度上的位置变化
4. **径向速度(RV)** - 可用于更精确的速度计算
5. **光谱类型详细信息** - 可用于确定恒星的详细属性（质量、寿命等）
6. **恒星半径和质量估算** - 可用于确定恒星的物理特性
7. **金属丰度** - 可用于确定行星形成的可能性
8. **变星类型** - 可用于特殊的游戏事件

## 技术实现

本工具使用以下技术栈：

- C# .NET 8.0
- ExcelDataReader: 用于读取Excel文件
- MIConvexHull: 用于Delaunay三角剖分
- Newtonsoft.Json: 用于JSON序列化
- MathNet.Spatial: 用于空间计算

## 许可证

MIT License
